<!DOCTYPE html>
{% extends "base.html" %}
{% load static %}

{% block content %}
    <div class="jumbotron jumbotron-fluid">
        <div class="container">
            <h1 class="display-4">Let's edit your playdate!</h1>
        </div>
        <div class="wrapper container row">
            <form action='/playdates/{{edit_playdate.id}}/edit' method="POST" class="col-6">
                {% csrf_token %}
                {% if messages %}
                <ul class = "list-unstyled lead">
                    {% for message in messages %}
                        <li class = "text-light bg-danger text-center">{{ message }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                <div class="form-group">
                    <label for="InputPark1">Park Name:</label>
                    <input type="text" class="form-control" id="InputPark1" name='park_name' aria-describedby="parkHelp" value='{{edit_playdate.park_name}}'>
                </div>
                <div class="form-group">
                    <label for="Inputaddress">Address:</label>
                    <input type="address" class="form-control" id="InputAddress" name='park_address' value='{{edit_playdate.park_address}}'>
                </div>
                <div class="form-group">
                    <label for="InputDate">Date:</label>
                    <input type="date" class="form-control" id="InputDate" name='date' value='{{edit_playdate.date}}'>
                </div>
                <div class="form-group">
                    <label for="InputTime">Time:</label>
                    <input type="time" class="form-control" id='InputTime' name='time' value='{{edit_playdate.time}}'>
                </div>
                <div class="form-group">
                    <label for="Inputcomment">Comment:</label>
                    <input type="text" class="form-control" id='InputComment' name='comments' value='{{edit_playdate.comments}}'>
                </div>
                <button type="submit" class="btn btn-success mr-2" >Submit</button>
                <td scope="col"><a href="/dashboard" class="btn btn-warning" role="button" aria-pressed="true">Cancel</a></td>
            </form>
            <script>             
                function initMap() 
                {
                    var map = new google.maps.Map(document.getElementById('map'), {
                        center: {lat: 41.2565, lng: -95.9345},
                        zoom: 3
                    });
                
                     // Try HTML5 geolocation.
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(function(position) {
                        var pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                
                        infoWindow.setPosition(pos);
                        infoWindow.setContent('Location found.');
                        infoWindow.open(map);
                        map.setCenter(pos);
                        }, function() {
                        handleLocationError(true, infoWindow, map.getCenter());
                        });
                    } else 
                    {
                        // Browser doesn't support Geolocation
                        handleLocationError(false, infoWindow, map.getCenter());
                    
                    }
                
                    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
                    infoWindow.setPosition(pos);
                    infoWindow.setContent(browserHasGeolocation ?
                                            'Error: The Geolocation service failed.' :
                                            'Error: Your browser doesn\'t support geolocation.');
                    infoWindow.open(map);
                    }
                
                    var card = document.getElementById('pac-card');
                    var input = document.getElementById('pac-input');
                    var types = document.getElementById('type-selector');
                    var strictBounds = document.getElementById('strict-bounds-selector');
                
                    map.controls[google.maps.ControlPosition.TOP_RIGHT].push(card);
                
                    var autocomplete = new google.maps.places.Autocomplete(input);
                
                    // Bind the map's bounds (viewport) property to the autocomplete object,
                    // so that the autocomplete requests use the current map bounds for the
                    // bounds option in the request.
                    autocomplete.bindTo('bounds', map);
                
                    // Set the data fields to return when the user selects a place.
                    autocomplete.setFields(
                        ['address_components', 'geometry', 'icon', 'name']);
                
                    var infowindow = new google.maps.InfoWindow();
                    var infowindowContent = document.getElementById('infowindow-content');
                    infowindow.setContent(infowindowContent);
                    var marker = new google.maps.Marker({
                    map: map,
                    anchorPoint: new google.maps.Point(0, -29)
                    });
                
                    autocomplete.addListener('place_changed', function() {
                    infowindow.close();
                    marker.setVisible(false);
                    var place = autocomplete.getPlace();
                    if (!place.geometry) {
                        // User entered the name of a Place that was not suggested and
                        // pressed the Enter key, or the Place Details request failed.
                        window.alert("No details available for input: '" + place.name + "'");
                        return;
                    }
                
                    // If the place has a geometry, then present it on a map.
                    if (place.geometry.viewport) {
                        map.fitBounds(place.geometry.viewport);
                    } else {
                        map.setCenter(place.geometry.location);
                        map.setZoom(17);  // Why 17? Because it looks good.
                    }
                    marker.setPosition(place.geometry.location);
                    marker.setVisible(true);
                
                    var address = '';
                    if (place.address_components) {
                        address = [
                        (place.address_components[0] && place.address_components[0].short_name || ''),
                        (place.address_components[1] && place.address_components[1].short_name || ''),
                        (place.address_components[2] && place.address_components[2].short_name || '')
                        ].join(' ');
                    }
                
                    infowindowContent.children['place-icon'].src = place.icon;
                    infowindowContent.children['place-name'].textContent = place.name;
                    infowindowContent.children['place-address'].textContent = address;
                    infowindow.open(map, marker);
                    });
                
                    // Sets a listener on a radio button to change the filter type on Places
                    // Autocomplete.
                    function setupClickListener(id, types) {
                    var radioButton = document.getElementById(id);
                    radioButton.addEventListener('click', function() {
                        autocomplete.setTypes(types);
                    });
                    }
                
                    setupClickListener('changetype-all', []);
                    setupClickListener('changetype-address', ['address']);
                    setupClickListener('changetype-establishment', ['establishment']);
                    setupClickListener('changetype-geocode', ['geocode']);
                
                    document.getElementById('use-strict-bounds')
                        .addEventListener('click', function() {
                        console.log('Checkbox clicked! New state=' + this.checked);
                        autocomplete.setOptions({strictBounds: this.checked});
                        });
                    
                }
                </script>
                <div class="col-6">
                    <h6>Verify dog park name and address here:</h6>
                    <div class="pac-card" id="pac-card">
                        <div id="title"> Autocomplete search</div>

                        <div id="type-selector" class="pac-controls">
                        <input type="radio" name="type" id="changetype-all" checked="checked">
                        <label for="changetype-all">All</label>
                    
                        <input type="radio" name="type" id="changetype-establishment">
                        <label for="changetype-establishment">Establishments</label>
                    
                        <input type="radio" name="type" id="changetype-address">
                        <label for="changetype-address">Addresses</label>
                    
                        <input type="radio" name="type" id="changetype-geocode">
                        <label for="changetype-geocode">Geocodes</label>
                        </div>
                        <div id="strict-bounds-selector" class="pac-controls">
                        <input type="checkbox" id="use-strict-bounds" value="">
                        <label for="use-strict-bounds">Strict Bounds</label>
                        </div>
                    </div>
                    <div id="pac-container">
                        <input id="pac-input" type="text"
                            placeholder="Enter a location">
                    </div>
                    <div id="map"></div>
                    <div id="infowindow-content">
                        <img src="" width="16" height="16" id="place-icon">
                        <span id="place-name"  class="title"></span><br>
                        <span id="place-address"></span>
                    </div>
                </div>
        </div>    
    </div>
    

{% endblock %}
</body>
</html>